# TetrisJs

## スクリプトの仕様 (`script.js`)

このスクリプトは、HTML5 Canvas を使用したテトリスゲームのロジックを実装しています。

### 主要な機能

- **ゲームの初期化 (`init`)**:
  - ゲームボード、スコア、ライン数、レベルをリセットします。
  - 最初のピースと次のピースを生成し、ゲームループを開始します。

- **ピースの生成と配置 (`createPiece`, `spawnNewPiece`)**:
  - ランダムなテトリミノ（ブロック）を生成します。
  - 生成されたピースをゲームボードの上部に配置します。
  - 初期位置で衝突が発生した場合、ゲームオーバーを判定します。

- **描画処理 (`draw`, `drawBoard`, `drawPiece`, `drawNextPiece`)**:
  - ゲームボード、現在のピース、次のピースを Canvas に描画します。

- **ゲームループ (`animate`)**:
  - ピースの自動落下を制御します。
  - 描画処理を繰り返し実行します。

- **ピースの操作**:
  - **`movePieceDown()`**: ピースを1マス下に移動させます。衝突する場合はピースを固定し、ライン消去と次のピース生成を行います。
  - **`movePieceLeft()`**: ピースを左に1マス移動させます。
  - **`movePieceRight()`**: ピースを右に1マス移動させます。
  - **`hardDrop()`**: ピースを一番下まで一気に落下させます。スコアボーナスが加算されます。
  - **`rotatePiece()`**: ピースを回転させます。壁キック処理も含まれます。

- **衝突判定 (`isValidMove`)**:
  - 指定された位置にピースを移動できるか（ボードの範囲内か、他のブロックと衝突しないか）を判定します。

- **ピースの固定 (`lockPiece`)**:
  - 現在のピースをゲームボードに固定します。

- **ライン消去とスコア計算 (`removeLines`)**:
  - 揃ったラインを検出し、削除します。
  - ライン数に応じてスコアとレベルを更新し、落下速度を調整します。
  - 4ライン同時消し（テトリス）の場合、派手なフラッシュ演出と花火が追加されます。

- **情報表示の更新 (`updateInfo`)**:
  - スコア、ライン数、レベルの表示を更新します。

- **ゲームオーバー処理 (`showGameOver`)**:
  - ゲームオーバー画面を表示し、ゲームループを停止します。

- **画面スケール調整 (`adjustGameScale`)**:
  - ウィンドウサイズに合わせてゲーム全体の表示を自動的に調整し、スクロールバーが表示されないようにします。

- **BGM再生**:
  - BGMが自動再生され、再生/一時停止ボタンで制御できます。音量は固定されており、キーボードでの調整はできません。
  - 音源はこちらからいただきました(https://x.com/hiiragi_magne/status/1856652375861469635?s=46&t=iQ5AUOzmN6MRS8JuxXd0Gg)

### イベントリスナー

- **キーボード操作**:
  - `ArrowLeft`, `KeyA`: 左移動
  - `ArrowRight`, `KeyD`: 右移動
  - `ArrowDown`, `KeyS`: ソフトドロップ（下に移動、スコアボーナス）
  - `ArrowUp`, `KeyW`: 回転
  - `Space`: ハードドロップ

- **フリック操作 (モバイル)**:
  - ゲーム画面（Canvas）上でのフリック操作に対応。
  - 左フリック: 左移動
  - 右フリック: 右移動
  - 下フリック: ソフトドロップ
  - 上フリック: 回転
  - タップ: ハードドロップ

- **再開ボタン**:
  - `restart-button`: ゲームを再開

- **BGMコントロール**:
  - `play-pause-button`: BGMの再生/一時停止を切り替えます。